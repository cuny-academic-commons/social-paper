tinymce.PluginManager.add("feeImage",function(a){function b(a){return a.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(a,b,c){var d,e,f,g,h,m,n=tinymce.trim;return d=b.match(/id=['"]([^'"]*)['"] ?/),d&&(b=b.replace(d[0],"")),e=b.match(/align=['"]([^'"]*)['"] ?/),e&&(b=b.replace(e[0],"")),f=b.match(/class=['"]([^'"]*)['"] ?/),f&&(b=b.replace(f[0],"")),m=b.match(/width=['"]([0-9]*)['"] ?/),m&&(b=b.replace(m[0],"")),c=n(c),h=c.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i),h&&h[2]?(g=n(h[2]),h=n(h[1])):(g=n(b).replace(/caption=['"]/,"").replace(/['"]$/,""),h=c),d=d&&d[1]?d[1].replace(/[<>&]+/g,""):"",e=e&&e[1]?e[1]:"alignnone",f=f&&f[1]?" "+f[1].replace(/[<>&]+/g,""):"",!m&&h&&(m=h.match(/width=['"]([0-9]*)['"]/)),m&&m[1]&&(m=m[1]),m&&g?(m=parseInt(m,10),i||(m+=10),'<div class="mceTemp"><'+j+' id="'+d+'" class="wp-caption '+e+f+'" style="width: '+m+'px"><'+k+' class="wp-caption-dt">'+h+"</"+k+"><"+l+' class="wp-caption-dd wp-caption-text">'+g+"</"+l+"></"+j+"></div>"):c})}function c(a){return a.replace(/<div (?:id="attachment_|class="mceTemp)[^>]*>([\s\S]+?)<\/div>/g,function(a,b){var c="";return-1===b.indexOf("<img ")?(c=b.match(new RegExp("<"+l+" [^>]+>([\\s\\S]+?)<\\/"+l+">","i")),c&&c[1]?"<p>"+c[1]+"</p>":""):(c=b.replace(new RegExp("<"+j+" ([^>]+)>\\s*<"+k+" [^>]+>([\\s\\S]+?)<\\/"+k+">\\s*<"+l+" [^>]+>([\\s\\S]*?)<\\/"+l+">\\s*<\\/"+j+">","gi"),function(a,b,c,d){var e,f,g,h;return h=c.match(/width="([0-9]*)"/),h=h&&h[1]?h[1]:"",h&&d?(e=b.match(/id="([^"]*)"/),e=e&&e[1]?e[1]:"",f=b.match(/class="([^"]*)"/),f=f&&f[1]?f[1]:"",g=f.match(/align[a-z]+/i)||"alignnone",f=f.replace(/wp-caption ?|align[a-z]+ ?/gi,""),f&&(f=' class="'+f+'"'),d=d.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(a){return a.replace(/[\r\n\t]+/," ")}),d=d.replace(/\s*\n\s*/g,"<br />"),'[caption id="'+e+'" align="'+g+'" width="'+h+'"'+f+"]"+c+" "+d+"[/caption]"):c}),c=tinymce.trim(c),0!==c.indexOf("[caption")&&(c=b.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),c)})}function d(b){var c,d,e,f,g,h,i,j,k=[],l=a.dom,m=/^\d+$/;return e={attachment_id:!1,size:"custom",caption:"",align:"none",extraClasses:"",link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:""},e.url=l.getAttrib(b,"src"),e.alt=l.getAttrib(b,"alt"),e.title=l.getAttrib(b,"title"),i=l.getAttrib(b,"width"),j=l.getAttrib(b,"height"),(!m.test(i)||parseInt(i,10)<1)&&(i=b.naturalWidth||b.width),(!m.test(j)||parseInt(j,10)<1)&&(j=b.naturalHeight||b.height),e.customWidth=e.width=i,e.customHeight=e.height=j,c=tinymce.explode(b.className," "),d=[],tinymce.each(c,function(a){/^wp-image/.test(a)?e.attachment_id=parseInt(a.replace("wp-image-",""),10):/^align/.test(a)?e.align=a.replace("align",""):/^size/.test(a)?e.size=a.replace("size-",""):d.push(a)}),e.extraClasses=d.join(" "),f=l.getParents(b,".wp-caption"),f.length&&(f=f[0],c=f.className.split(" "),tinymce.each(c,function(a){/^align/.test(a)?e.align=a.replace("align",""):a&&"wp-caption"!==a&&k.push(a)}),e.captionClassName=k.join(" "),g=l.select(".wp-caption-dd",f),g.length&&(g=g[0],e.caption=a.serializer.serialize(g).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))),b.parentNode&&"A"===b.parentNode.nodeName&&(h=b.parentNode,e.linkUrl=l.getAttrib(h,"href"),e.linkTargetBlank="_blank"===l.getAttrib(h,"target")?!0:!1,e.linkRel=l.getAttrib(h,"rel"),e.linkClassName=h.className),e}function e(a){return a&&!(!a.textContent&&!a.innerText)}function f(b,c){var d,f,g,h,m,n,o,p,q,r,s,t,u,v,w,x,y=a.dom;d=tinymce.explode(c.extraClasses," "),d||(d=[]),c.caption||d.push("align"+c.align),c.attachment_id&&(d.push("wp-image-"+c.attachment_id),c.size&&"custom"!==c.size&&d.push("size-"+c.size)),v=c.width,w=c.height,"custom"===c.size&&(v=c.customWidth,w=c.customHeight),t={src:c.url,width:v||null,height:w||null,alt:c.alt,title:c.title||null,"class":d.join(" ")||null},y.setAttribs(b,t),u={href:c.linkUrl,rel:c.linkRel||null,target:c.linkTargetBlank?"_blank":null,"class":c.linkClassName||null},b.parentNode&&"A"===b.parentNode.nodeName&&!e(b.parentNode)?c.linkUrl?y.setAttribs(b.parentNode,u):y.remove(b.parentNode,!0):c.linkUrl&&((o=y.getParent(b,"a"))&&y.insertAfter(b,o),o=y.create("a",u),b.parentNode.insertBefore(o,b),o.appendChild(b)),p=a.dom.getParent(b,".mceTemp"),g=b.parentNode&&"A"===b.parentNode.nodeName&&!e(b.parentNode)?b.parentNode:b,c.caption?(s=c.attachment_id?"attachment_"+c.attachment_id:null,x="align"+(c.align||"none"),f="wp-caption "+x,c.captionClassName&&(f+=" "+c.captionClassName.replace(/[<>&]+/g,"")),i||(v=parseInt(v,10),v+=10),p?(r=y.select(".wp-caption",p),r.length&&y.setAttribs(r,{id:s,"class":f,style:"width: "+v+"px"}),q=y.select(".wp-caption-dd",p),q.length&&y.setHTML(q[0],c.caption)):(s=s?'id="'+s+'" ':"",h="<"+j+" "+s+'class="'+f+'" style="width: '+v+'px"><'+k+' class="wp-caption-dt">'+y.getOuterHTML(g)+"</"+k+"><"+l+' class="wp-caption-dd wp-caption-text">'+c.caption+"</"+l+"></"+j+">",(m=y.getParent(g,"p"))?(n=y.create("div",{"class":"mceTemp"},h),m.parentNode.insertBefore(n,m),y.remove(g),y.isEmpty(m)&&y.remove(m)):y.setOuterHTML(g,'<div class="mceTemp">'+h+"</div>"))):p&&(m=y.create("p"),p.parentNode.insertBefore(m,p),m.appendChild(g),y.remove(p)),wp.media.events&&wp.media.events.trigger("editor:image-update",{editor:a,metadata:c,image:b}),a.nodeChanged()}function g(b){var c,e,g;return"undefined"!=typeof wp&&wp.media?(g=d(b),wp.media.events.trigger("editor:image-edit",{editor:a,metadata:g,image:b}),c=wp.media({frame:"image",state:"image-details",metadata:g}),wp.media.events.trigger("editor:frame-create",{frame:c}),e=function(d){a.focus(),a.undoManager.transact(function(){f(b,d)}),c.detach()},c.state("image-details").on("update",e),c.state("replace-image").on("replace",e),c.on("close",function(){a.focus(),c.detach()}),void c.open()):void a.execCommand("mceImage")}function h(b){var c;"DIV"===b.nodeName&&a.dom.hasClass(b,"mceTemp")?c=b:("IMG"===b.nodeName||"DT"===b.nodeName||"A"===b.nodeName)&&(c=a.dom.getParent(b,"div.mceTemp")),c?(a.selection.select(c.nextSibling?c.nextSibling:c.previousSibling?c.previousSibling:c.parentNode),a.selection.collapse(!0),a.nodeChanged(),a.dom.remove(c)):a.dom.remove(b)}var i=a.getParam("wpeditimage_html5_captions"),j=i?"figure":"dl",k=i?"section":"dt",l=i?"figcaption":"dd";return a.on("init",function(){var b=a.dom;a.on("wpLoadImageForm",function(b){if(!a.getParam("wpeditimage_disable_captions")){var c={type:"textbox",flex:1,name:"caption",minHeight:60,multiline:!0,scroll:!0,label:"Image caption"};b.data.splice(b.data.length-1,0,c)}}),a.on("wpNewImageRefresh",function(a){var c,d;(c=b.getParent(a.node,".wp-caption"))&&(c.style.width||(d=parseInt(a.node.clientWidth,10)+10,d=d?d+"px":"50%",b.setStyle(c,"width",d)))}),a.on("wpImageFormSubmit",function(c){var d,e,f,g,h,m=c.imgData.data,n=c.imgData.node,o=c.imgData.caption,p="",q="",r="";return m.id="__wp-temp-img-id",c.imgData.cancel=!0,m.style||(m.style=null),m.src?(o&&(o=o.replace(/\r\n|\r/g,"\n").replace(/<\/?[a-zA-Z0-9]+( [^<>]+)?>/g,function(a){return a.replace(/[\r\n\t]+/," ")}),o=o.replace(/(<br[^>]*>)\s*\n\s*/g,"$1").replace(/\s*\n\s*/g,"<br />")),n?(h=n.id||null,b.setAttribs(n,m),d=b.getParent(n,".wp-caption"),o?d?(e=b.select(".wp-caption-dd",d)[0])&&(e.innerHTML=o):(n.className&&(p=n.className.match(/wp-image-([0-9]+)/),q=n.className.match(/align(left|right|center|none)/)),q?(q=q[0],n.className=n.className.replace(/align(left|right|center|none)/g,"")):q="alignnone",q=' class="wp-caption '+q+'"',p&&(p=' id="attachment_'+p[1]+'"'),r=m.width||n.clientWidth,r&&(r=parseInt(r,10),i||(r+=10),r=' style="width: '+r+'px"'),n.parentNode&&"A"===n.parentNode.nodeName?(g=b.getOuterHTML(n.parentNode),f=n.parentNode):(g=b.getOuterHTML(n),f=n),g="<"+j+" "+p+q+r+"><"+k+' class="wp-caption-dt">'+g+"</"+k+"><"+l+' class="wp-caption-dd wp-caption-text">'+o+"</"+l+"></"+j+">",(e=b.getParent(n,"p"))?(d=b.create("div",{"class":"mceTemp"},g),b.insertAfter(d,e),a.selection.select(d),a.nodeChanged(),b.remove(f),b.isEmpty(e)&&b.remove(e)):a.selection.setContent('<div class="mceTemp">'+g+"</div>")):d&&(g=b.getOuterHTML("A"===n.parentNode.nodeName?n.parentNode:n),e=b.create("p",{},g),b.insertAfter(e,d.parentNode),a.selection.select(e),a.nodeChanged(),b.remove(d.parentNode))):(g=b.createHTML("img",m),o?(f=a.selection.getNode(),m.width&&(r=parseInt(m.width,10),i||(r+=10),r=' style="width: '+r+'px"'),g="<"+j+' class="wp-caption alignnone"'+r+"><"+k+' class="wp-caption-dt">'+g+"</"+k+"><"+l+' class="wp-caption-dd wp-caption-text">'+o+"</"+l+"></"+j+">",e="P"===f.nodeName?f:b.getParent(f,"p"),e&&"P"===e.nodeName?(d=b.create("div",{"class":"mceTemp"},g),e.parentNode.insertBefore(d,e),a.selection.select(d),a.nodeChanged(),b.isEmpty(e)&&b.remove(e)):a.selection.setContent('<div class="mceTemp">'+g+"</div>")):a.selection.setContent(g)),n=b.get("__wp-temp-img-id"),b.setAttrib(n,"id",h),void(c.imgData.node=n)):void(n&&(b.remove((d=b.getParent(n,"div.mceTemp"))?d:"A"===n.parentNode.nodeName?n.parentNode:n),a.nodeChanged()))}),a.on("wpLoadImageData",function(c){var d,e=c.imgData.data,f=c.imgData.node;(d=b.getParent(f,".wp-caption"))&&(d=b.select(".wp-caption-dd",d)[0],d&&(e.caption=a.serializer.serialize(d).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,"")))}),b.bind(a.getDoc(),"dragstart",function(c){var d=a.selection.getNode();"IMG"===d.nodeName&&b.getParent(d,".wp-caption")&&c.preventDefault()}),tinymce.Env.ie&&tinymce.Env.ie>10&&(b.bind(a.getBody(),"mscontrolselect",function(c){"IMG"===c.target.nodeName&&b.getParent(c.target,".wp-caption")?a.getBody().focus():"DL"===c.target.nodeName&&b.hasClass(c.target,"wp-caption")&&c.target.focus()}),a.on("click",function(c){"IMG"===c.target.nodeName&&b.getAttrib(c.target,"data-wp-imgselect")&&b.getParent(c.target,".wp-caption")&&a.getBody().focus()}))}),a.on("ObjectResized",function(b){var c=b.target;"IMG"===c.nodeName&&a.undoManager.transact(function(){var d,e,f=a.dom;c.className=c.className.replace(/\bsize-[^ ]+/,""),(d=f.getParent(c,".wp-caption"))&&(e=b.width||f.getAttrib(c,"width"),e&&(e=parseInt(e,10),i||(e+=10),f.setStyle(d,"width",e+"px")))})}),a.on("BeforeExecCommand",function(b){var c,d,e,f,g=b.command,h=a.dom;if("mceInsertContent"===g)(c=h.getParent(a.selection.getNode(),"div.mceTemp"))&&(d=h.create("p"),h.insertAfter(d,c),a.selection.setCursorLocation(d,0),a.nodeChanged());else if("JustifyLeft"===g||"JustifyRight"===g||"JustifyCenter"===g||"alignnone"===g){if(c=a.selection.getNode(),f="align"+g.slice(7).toLowerCase(),e=a.dom.getParent(c,".wp-caption"),"IMG"!==c.nodeName&&!e)return;c=e||c,"alignleft"!==f&&a.dom.removeClass(c,"alignleft"),"aligncenter"!==f&&a.dom.removeClass(c,"aligncenter"),"alignright"!==f&&a.dom.removeClass(c,"alignright"),"alignnone"!==f&&a.dom.toggleClass(c,f),a.nodeChanged(),b.preventDefault()}}),a.on("keydown",function(b){var c,d,e,f,g=a.selection,i=b.keyCode,j=a.dom;if(i===tinymce.util.VK.ENTER)c=g.getNode(),d=j.getParent(c,"div.mceTemp"),d&&(j.events.cancel(b),tinymce.each(j.select(".wp-caption-dt, .wp-caption-dd",d),function(a){j.isEmpty(a)&&j.remove(a)}),f=tinymce.Env.ie&&tinymce.Env.ie<11?"":'<br data-mce-bogus="1" />',e=j.create("p",null,f),"DD"===c.nodeName?j.insertAfter(e,d):d.parentNode.insertBefore(e,d),a.nodeChanged(),g.setCursorLocation(e,0));else if((i===tinymce.util.VK.DELETE||i===tinymce.util.VK.BACKSPACE)&&(c=g.getNode(),"DIV"===c.nodeName&&j.hasClass(c,"mceTemp")?d=c:("IMG"===c.nodeName||"DT"===c.nodeName||"A"===c.nodeName)&&(d=j.getParent(c,"div.mceTemp")),d))return j.events.cancel(b),h(c),!1}),a.wpSetImgCaption=function(a){return b(a)},a.wpGetImgCaption=function(a){return c(a)},a.on("BeforeSetContent",function(b){"raw"!==b.format&&(b.content=a.wpSetImgCaption(b.content))}),a.on("PostProcess",function(b){b.get&&(b.content=a.wpGetImgCaption(b.content),b.content=b.content.replace(/ data-wp-imgselect="1"/g,""))}),a.addButton("remove",{tooltip:"Remove",icon:"dashicons-no",onclick:function(){h(a.selection.getNode())}}),a.addButton("edit",{tooltip:"Edit",icon:"dashicons-edit",onclick:function(){g(a.selection.getNode())}}),tinymce.each({alignleft:"Align Left",aligncenter:"Align Center",alignright:"Align Right",alignnone:"Don’t Align"},function(b,c){var d=c.slice(5);a.addButton("img"+c,{tooltip:b,icon:"dashicons-align-"+d,cmd:"alignnone"===c?c:"Justify"+d.slice(0,1).toUpperCase()+d.slice(1),onPostRender:function(){var b=this;a.on("NodeChange",function(d){var e=a.dom.getParent(d.element,".wp-caption")||d.element;b.active("alignnone"===c?!a.dom.hasClass(e,"alignleft")&&!a.dom.hasClass(e,"aligncenter")&&!a.dom.hasClass(e,"alignright"):a.dom.hasClass(e,c))})}})}),{_do_shcode:b,_get_shcode:c}}),tinymce.PluginManager.add("insert",function(a){"use strict";function b(b){var c=a.getBody();if(b===c)return b.firstChild;for(;b;){if(b.parentNode===c)return b;b=b.parentNode}return!1}var c,d,e=tinymce.DOM;a.on("keyup mouseup NodeChange",function(b){var d=b.element||a.selection.getNode();c.hide(),d="BR"===d.nodeName?d.parentNode:d,"P"!==d.nodeName||!a.dom.isEmpty(d)||a.plugins.wpview&&a.plugins.wpview.getView(d)||c.show(d)}),a.on("keydown blur hide deactivate",function(){c.hide()}),e.bind(document,"keydown",function(){c._visible&&!d._visible&&(c.hide(),a.focus())}),a.on("PreInit",function(){var f;c=tinymce.ui.Factory.create({type:"panel",layout:"stack",classes:"insert",ariaRoot:!0,ariaRemember:!0,html:'<span class="dashicons dashicons-plus-alt"></span> Add a block',onclick:function(){d._visible?d.hide():d.setPos(f)}}),d=tinymce.ui.Factory.create({type:"panel",layout:"flow",classes:"insert-modal",ariaRoot:!0,ariaRemember:!0,items:a.toolbarItems(a.settings.blocks,!0)}),c.on("show",function(){this.setPos()}),c.on("hide",function(){d.hide()}),e.bind(window,"resize",function(){c.hide(),d.hide()}),c.setPos=function(b){b=b||a.selection.getNode(),b="BR"===b.nodeName?b.parentNode:b;var c=this.getEl(),d=a.dom.getPos(b),f=(b.clientHeight-c.clientHeight)/2;return e.setStyles(c,{left:d.x,top:d.y+f,color:a.dom.getStyle(b,"color",!0)}),this},c.renderTo(document.body).hide(),d.on("hide",function(){a.dom.remove(a.dom.select(".mce-insert-placeholder")),e.removeClass(c.getEl(),"open")}),d.setPos=function(f){f=f||a.selection.getNode(),f="BR"===f.nodeName?f.parentNode:f;var g,h=a.dom,i=b(f),j=this.getEl(),k=a.dom.getPos(a.getBody());return e.addClass(c.getEl(),"open"),g=h.create("p",{"data-mce-bogus":"all","class":"mce-insert-placeholder",style:"height: 0px;"}," "),h.insertAfter(g,i),e.setStyles(j,{left:k.x,top:a.dom.getPos(g).y,width:a.getBody().clientWidth,opacity:0}),d.show(),a.dom.setStyles(g,{height:j.clientHeight}),jQuery(g).hide().height(j.clientHeight).slideDown("fast",function(){e.setStyles(j,{opacity:1})}),this},d.renderTo(document.body).hide()}),a.addButton("wp_media",{tooltip:"Media",icon:"dashicons-admin-media",onclick:function(){wp.media.editor.open(a.id)}})}),tinymce.PluginManager.add("feeMarkDown",function(a){var b,c,d=[],e=[];c=a.addMarkDown=function(a,b,c){var f,g;if(e.push({regExp:a,callback:b}),c)for(f=0;f<c.length;f++)g=c.charAt(f),-1===tinymce.inArray(d,g)&&" "!==g&&d.push(g)},c(/^[*+-]\s/,function(){this.execCommand("InsertUnorderedList")}),c(/^1[.)]\s/,function(){this.execCommand("InsertOrderedList")}),c(/^>\s/,function(){this.execCommand("mceBlockQuote")}),c(/^(#{2,6})\s/,function(){this.formatter.toggle("h"+arguments[1].length)}),c(/(\*{1,2})(\S[^*]*)\*/,function(){this.insertContent(2===arguments[1].length?"<strong>"+arguments[2]+"</strong>":"<em>"+arguments[2]+"</em>")},"*"),c(/`(\S[^`]*)`/,function(){this.insertContent("<code>"+arguments[1]+"</code>")},"`"),c(/\[([^\]]+)\]\(([^)\s]+)(?:\s['"]([^)]+)['"])?\)/,function(){this.insertContent('<a href="'+arguments[2]+'"'+(arguments[3]?' title="'+arguments[3]+'"':"")+">"+arguments[1]+"</a>")},")"),c(/^---$/,function(){this.insertContent("<hr>")},"-"),c(/\:-?([()?oxPD|])/,function(){this.insertContent('<img src="http://wp/src/wp-includes/images/smilies/icon_smile.gif" alt=":-'+arguments[1]+'" class="wp-smiley">')},"()?oxPD|"),a.on("keydown",function(){b=a.selection.getRng().startOffset}),a.on("keyup",function(c){var f,g=a.selection.getRng().startContainer;3===g.nodeType&&(f=g.textContent.charAt(b),(c.keyCode===tinymce.util.VK.SPACEBAR||-1!==tinymce.inArray(d,f))&&tinymce.each(e,function(b){var c,d=g.textContent.replace(b.regExp,function(){return c=arguments,"^"===b.regExp.source.charAt(0)&&g.parentNode.firstChild!==g?arguments[0]:"$"===b.regExp.source.charAt(b.regExp.source.length-1)&&g.parentNode.lastChild!==g?arguments[0]:""});g.textContent!==d&&a.undoManager.transact(function(){g.textContent=d,a.selection.setCursorLocation(g,c[c.length-2]),"^"===b.regExp.source.charAt(0)&&""===d&&a.insertContent("<br>"),b.callback.apply(a,c)})}))})}),tinymce.PluginManager.add("wpmore",function(a){a.addCommand("WP_More",function(b){var c,d,e=a.dom,f=a.selection.getNode(),g=a.getBody();return b=b||"more",d="<!--"+b+"-->",f===g||"P"===f.nodeName&&f.parentNode===g?void a.insertContent(d):(c=e.getParent(f,function(a){return a.parentNode&&a.parentNode===g?!0:!1},a.getBody()),void(c&&("P"===c.nodeName?c.appendChild(e.create("p",null,d).firstChild):e.insertAfter(e.create("p",null,d),c),a.nodeChanged())))}),a.addCommand("WP_Page",function(){a.execCommand("WP_More","nextpage")}),a.addButton("wp_more",{tooltip:"Read More",onclick:function(){a.execCommand("WP_More","more")}}),a.addButton("wp_page",{tooltip:"Page Break",onclick:function(){a.execCommand("WP_More","nextpage")}})}),tinymce.ThemeManager.add("fee",function(a){function b(a,b){for(;a;){if(a.nodeName===b)return a;a=a.parentNode}return!1}function c(c,d){var e,f=[];if(c)return i(c,function(c){function i(){var b=a.selection;"bullist"===k&&b.selectorChanged("ul > li",function(a,b){for(var d,e=b.parents.length;e--&&(d=b.parents[e].nodeName,"OL"!==d&&"UL"!==d););c.active(a&&"UL"===d)}),"numlist"===k&&b.selectorChanged("ol > li",function(a,b){for(var d,e=b.parents.length;e--&&(d=b.parents[e].nodeName,"OL"!==d&&"UL"!==d););c.active(a&&"OL"===d)}),c.settings.stateSelector&&b.selectorChanged(c.settings.stateSelector,function(a){c.active(a)},!0),c.settings.disabledStateSelector&&b.selectorChanged(c.settings.disabledStateSelector,function(a){c.disabled(a)})}var k;"|"===c?e=null:h.has(c)?(c={type:c},g.toolbar_items_size&&(c.size=g.toolbar_items_size),f.push(c),e=null):((!e||d)&&(e={type:"buttongroup",items:[]},f.push(e)),a.buttons[c]&&(k=c,c=a.buttons[k],"function"==typeof c&&(c=c()),c.icon&&-1!==c.icon.indexOf("dashicons")&&(c.icon="dashicon "+c.icon),d&&(c.text=c.tooltip,c.tooltip=!1),c.type=c.type||"button",g.toolbar_items_size&&(c.size=g.toolbar_items_size),"link"===k?c.onPostRender=function(){var c=this;a.on("NodeChange",function(a){c.active(b(a.element,"A"))})}:"unlink"===k&&(c.onPostRender=function(){var b=this;a.on("NodeChange",function(c){var d="A"!==c.element.nodeName&&-1===a.selection.getContent().indexOf("<a");b.disabled(d),j.setAttrib(b.getEl(),"tabindex",d?"0":"-1")})},c.onclick=function(){-1===a.selection.getContent().indexOf("<a")&&a.selection.select(a.selection.getNode()),a.execCommand("unlink")}),c=h.create(c),e.items.push(c),a.initialized?i():a.on("init",i)))}),f}function d(a){return h.create({type:"panel",layout:"stack",classes:"toolbar-grp",ariaRoot:!0,ariaRemember:!0,items:[{type:"toolbar",layout:"flow",items:c(a)}]})}var e,f=this,g=a.settings,h=tinymce.ui.Factory,i=tinymce.each,j=tinymce.DOM,k=32;i({H1:"Heading 1",H2:"Heading 2",H3:"Heading 3",H4:"Heading 4",H5:"Heading 5",H6:"Heading 6",Pre:"Preformatted"},function(b,c){var d=c.toLowerCase();a.addButton(d,{tooltip:b,text:c,onclick:function(){a.formatter.toggle(d)},onPostRender:function(){var b=this;a.on("nodeChange",function(c){i(c.parents,function(c){b.active(!!a.formatter.matchNode(c,d))})})}})}),a.toolbarItems=c,f.renderUI=function(){function b(){return""===a.getContent({format:"raw"}).replace(/(?:<p[^>]*>)?(?:<br[^>]*>)?(?:<\/p>)?/,"")}var c,l,m={},n=0;return g.content_editable=!0,a.on("activate focus",function(){e=!0,j.addClass(a.getBody(),"mce-edit-focus")}),a.on("deactivate blur hide",function(){e=!1,j.removeClass(a.getBody(),"mce-edit-focus")}),a.on("remove",function(){c&&c.remove(),c=null}),g.placeholder&&(a.on("blur LoadContent deactivate",function(){b()&&(a.setContent(g.placeholder),l=!0,j.addClass(a.getBody(),"mce-placeholder"))}),a.on("focus activate",function(){l&&a.setContent("")}),a.on("SetContent",function(b){l&&!b.load&&(l=!1,j.removeClass(a.getBody(),"mce-placeholder"))}),a.on("PostProcess",function(a){l&&a.content&&(a.content="")}),a.on("BeforeAddUndo",function(a){l&&a.preventDefault()})),g.toolbar&&g.toolbar.length&&!c?("relative"===j.getStyle(document.body,"position",!0)&&(n=parseInt(j.getStyle(document.body,"margin-top",!0),10)+parseInt(j.getStyle(document.documentElement,"padding-top",!0),10)+parseInt(j.getStyle(document.documentElement,"margin-top",!0),10)),m.normal=d(g.toolbar),m.img=d(["imgalignleft","imgaligncenter","imgalignright","imgalignnone","edit","remove"]),m.view=d(["editview","removeview"]),c=f.panel=h.create({type:"floatpanel",role:"application",classes:"tinymce tinymce-inline",layout:"stack",autohide:!0,items:[m.normal,m.img,m.view]}),c.reposition=function(b,c){var d,e,f,g,h,l=this.getEl(),o=c||a.selection.getRng(),p=o.getBoundingClientRect(),q=(p.left+p.right)/2,r=window.innerWidth,s=parseInt(j.getStyle(l,"margin-bottom",!0),10)+n;return l.className=(" "+l.className+" ").replace(/\smce-arrow-\S+\s/g," ").slice(1,-1),b=b||"normal",m[b]._visible||(i(m,function(a){a.hide()}),m[b].show()),d=l.offsetWidth,e=d/2,p.top<l.offsetHeight+k?(h=" mce-arrow-up",f=p.bottom+s):(h=" mce-arrow-down",f=p.top-l.offsetHeight-s),g=q-e,d>=r?(h+=" mce-arrow-full",g=0):0>g&&p.left+d>r||g+d>r&&p.right-d<0?g=(r-d)/2:0>g?(h+=" mce-arrow-left",g=p.left):g+d>r&&(h+=" mce-arrow-right",g=p.right-d),l.className+=h,j.setStyles(l,{left:g,top:f+window.pageYOffset}),this},c.on("show",function(){var a=this;setTimeout(function(){a._visible&&j.addClass(a.getEl(),"mce-inline-toolbar-active")},100)}),c.on("hide",function(){j.removeClass(this.getEl(),"mce-inline-toolbar-active")}),c.on("cancel",function(){a.focus()}),j.bind(window,"resize",function(){c.hide()}),a.on("selectionchange nodechange",function(b){var d=b.element||a.selection.getNode(),f=a.plugins.wpview.getView();return a.selection.isCollapsed()&&!f?void c.hide():void setTimeout(function(){var b,g;e&&(!a.selection.isCollapsed()&&(b=a.selection.getContent())&&(b.replace(/<[^>]+>/g,"").trim()||0===b.indexOf("<"))&&"HR"!==d.nodeName||f?(g=f?"view":"IMG"===d.nodeName?"img":"normal",c.show().reposition(g,f)):c.hide())},100)}),a.shortcuts.add("Alt+F10","",function(){var a=c.find("toolbar")[0];a&&a.focus(!0)}),c.renderTo(document.body).reflow().hide(),i(m,function(a){a.hide()}),{}):{}}}),tinymce.PluginManager.add("wpview",function(a){function b(a){return a?c(a,"wpview-wrap"):n}function c(a,b){for(;a&&a.parentNode;){if(a.className&&-1!==(" "+a.className+" ").indexOf(" "+b+" "))return a;a=a.parentNode}return!1}function d(c){return(c=b(c))?window.decodeURIComponent(a.dom.getAttrib(c,"data-wpview-text")||""):""}function e(c,d){return c=b(c),c?(a.dom.setAttrib(c,"data-wpview-text",window.encodeURIComponent(d||"")),!0):!1}function f(a){a.stopPropagation()}function g(b,c){var d=b?"before":"after",e=b?0:1;k(),a.selection.setCursorLocation(a.dom.select(".wpview-selection-"+d,c)[0],e),a.nodeChanged()}function h(b,c,d){var e=a.dom,f=e.create("p");t.ie&&t.ie<11||(f.innerHTML='<br data-mce-bogus="1">'),c?b.parentNode.insertBefore(f,b):e.insertAfter(f,b),k(),c&&d===u.ENTER?g(c,b):a.selection.setCursorLocation(f,0),a.nodeChanged()}function i(b){a.undoManager.transact(function(){h(b),a.dom.remove(b)})}function j(b){var c,e=a.dom;!b||b===n&&r||(a.getBody().focus(),k(),n=b,e.setAttrib(b,"data-mce-selected",1),c=e.create("div",{"class":"wpview-clipboard"},d(b)),a.dom.select(".wpview-body",b)[0].appendChild(c),e.bind(c,"beforedeactivate focusin focusout",f),e.bind(n,"beforedeactivate focusin focusout",f),a.selection.select(c,!0),a.nodeChanged())}function k(){var b,c=a.dom;n&&(b=a.dom.select(".wpview-clipboard",n)[0],c.unbind(b),c.remove(b),c.unbind(n,"beforedeactivate focusin focusout click mouseup",f),c.setAttrib(n,"data-mce-selected",null)),n=null}function l(a){return a.replace(/<div[^>]+data-wpview-text=\"([^"]+)"[^>]*>[\s\S]+?wpview-selection-after[^>]+>(?:&nbsp;|\u00a0)*<\/p><\/div>/g,"$1")}function m(a){return 47>=a&&a!==u.SPACEBAR&&a!==u.ENTER&&a!==u.DELETE&&a!==u.BACKSPACE&&(37>a||a>40)||144===a||145===a||a>=91&&93>=a||a>=112&&123>=a}var n,o,p,q,r,s,t=tinymce.Env,u=tinymce.util.VK,v=tinymce.dom.TreeWalker,w=!1,x=!0,y=function(){return!1};return"undefined"!=typeof wp&&wp.mce?(a.on("BeforeAddUndo",function(a){a.lastLevel&&l(a.level.content)===l(a.lastLevel.content)&&a.preventDefault()}),a.on("BeforeSetContent",function(b){var c;b.content&&(n&&i(n),c=a.selection.getNode(),(!b.content.match(/^\s*(https?:\/\/[^\s"]+)\s*$/i)||"P"===c.nodeName&&c.parentNode===a.getBody()&&a.dom.isEmpty(c))&&(b.content=wp.mce.views.toViews(b.content)))}),a.on("SetContent show",function(){wp.mce.views.render()}),a.on("init",function(){var c=a.selection;a.on("BeforeSetContent",function(){var d,e,f=b(c.getNode());f&&(!f.nextSibling||b(f.nextSibling)?(e=a.getDoc().createTextNode(""),a.dom.insertAfter(e,f)):(d=new v(f.nextSibling,f.nextSibling),e=d.next()),c.select(e),c.collapse(!0))}),a.dom.bind(a.getBody(),"mousedown mouseup click",function(c){var d=b(c.target);if(x=!1,d){if(c.stopPropagation(),"mousedown"===c.type&&!c.metaKey&&!c.ctrlKey){if(a.dom.hasClass(c.target,"edit"))return wp.mce.views.edit(d),a.focus(),!1;if(a.dom.hasClass(c.target,"remove"))return i(d),!1}return j(d),!1}"mousedown"===c.type&&k()}),a.dom.bind(document,"click",function(c){var d,e=c.clientX,f=c.clientY,h=a.getBody(),i=h.getBoundingClientRect(),j=h.firstChild,k=j.getBoundingClientRect(),l=h.lastChild,m=l.getBoundingClientRect();k.top-10<=f&&f<k.top&&(d=b(j))?(g(!0,d),c.preventDefault()):m.bottom+10>=f&&f>m.bottom&&(d=b(l))?(g(!1,d),c.preventDefault()):tinymce.each(a.dom.select(".wpview-wrap"),function(a){var b=a.getBoundingClientRect();return b.top-10<=f&&f<=b.bottom+10?void(i.left-10<=e&&e<i.left?(g(!0,a),c.preventDefault()):i.right+10>=e&&e>i.right&&(g(!1,a),c.preventDefault())):void 0})})}),a.on("PreProcess",function(b){tinymce.each(a.dom.select("div[data-wpview-text]",b.node),function(a){a.textContent=a.innerText=" "})}),a.on("PostProcess",function(a){a.content&&(a.content=a.content.replace(/<div [^>]*?data-wpview-text="([^"]*)"[^>]*>[\s\S]*?<\/div>/g,function(a,b){return b?"<p>"+window.decodeURIComponent(b)+"</p>":""}))}),a.on("keydown",function(c){var d,e,f,l,o,q,r,s=c.keyCode,t=a.dom,v=a.selection;if(n){if((c.metaKey||c.ctrlKey)&&s!==u.BACKSPACE&&86!==s||s>=112&&123>=s)return void((c.metaKey||c.ctrlKey)&&88===s&&(w=n));if(e=b(v.getNode()),e!==n)return void k();s===u.LEFT?(g(!0,e),c.preventDefault()):s===u.UP?(e.previousSibling?b(e.previousSibling)?g(!0,e.previousSibling):(k(),v.select(e.previousSibling,!0),v.collapse()):g(!0,e),c.preventDefault()):s===u.RIGHT?(g(!1,e),c.preventDefault()):s===u.DOWN?(e.nextSibling?b(e.nextSibling)?g(!1,e.nextSibling):(k(),v.setCursorLocation(e.nextSibling,0)):g(!1,e),c.preventDefault()):m(s)||(i(n),(s===u.ENTER||s===u.DELETE||s===u.BACKSPACE)&&c.preventDefault())}else{if(c.metaKey||c.ctrlKey||s>=112&&123>=s)return;if(d=v.getNode(),p=d,e=b(d),v.isCollapsed()||(o=v.getRng(),(e=b(o.endContainer))?(q=o.cloneRange(),v.select(e.previousSibling,!0),v.collapse(),r=v.getRng(),q.setEnd(r.endContainer,r.endOffset),v.setRng(q)):(e=b(o.startContainer))&&(q=o.cloneRange(),q.setStart(e.nextSibling,0),v.setRng(q))),!e)return void(c.keyCode===u.BACKSPACE&&(a.dom.isEmpty(d)?(e=b(d.previousSibling))&&(g(!1,e),a.dom.remove(d),c.preventDefault()):(o=v.getRng())&&0===o.startOffset&&0===o.endOffset&&(e=b(d.previousSibling))&&(g(!1,e),c.preventDefault())));if(!(f=t.hasClass(e,"wpview-selection-before"))&&!(l=t.hasClass(e,"wpview-selection-after")))return;if(m(s))return;l&&s===u.UP||f&&s===u.BACKSPACE?(e.previousSibling?b(e.previousSibling)?g(!1,e.previousSibling):t.isEmpty(e.previousSibling)&&s===u.BACKSPACE?t.remove(e.previousSibling):(v.select(e.previousSibling,!0),v.collapse()):g(!0,e),c.preventDefault()):!l||s!==u.DOWN&&s!==u.RIGHT?!f||s!==u.UP&&s!==u.LEFT?f&&s===u.DOWN?(e.nextSibling?b(e.nextSibling)?g(!0,e.nextSibling):v.setCursorLocation(e.nextSibling,0):g(!1,e),c.preventDefault()):l&&s===u.LEFT||f&&s===u.RIGHT?(j(e),c.preventDefault()):l&&s===u.BACKSPACE?(i(e),c.preventDefault()):l?h(e):f&&h(e,!0,s):(e.previousSibling&&(b(e.previousSibling)?g(s===u.UP,e.previousSibling):(v.select(e.previousSibling,!0),v.collapse())),c.preventDefault()):(e.nextSibling&&(b(e.nextSibling)?g(s===u.RIGHT,e.nextSibling):v.setCursorLocation(e.nextSibling,0)),c.preventDefault()),s===u.ENTER&&c.preventDefault()}}),a.on("keyup",function(){w&&(i(w),w=!1)}),a.on("focus",function(){var c;r=!0,a.dom.addClass(a.getBody(),"has-focus"),x&&(c=b(a.getBody().firstChild))&&g(!0,c),x=!1}),a.on("blur",function(){r=!1,a.dom.removeClass(a.getBody(),"has-focus")}),a.on("NodeChange",function(d){var e=a.dom,f=a.dom.select(".wpview-wrap"),h=d.element.className,i=b(d.element),j=p;if(p=!1,clearInterval(o),tinymce.each(f,function(a){a.className&&(a.className=a.className.replace(/ ?\bwpview-(?:selection-before|selection-after|cursor-hide)\b/g,""))}),r)if(i)if("wpview-selection-before"!==h&&"wpview-selection-after"!==h||!a.selection.isCollapsed())c(d.element,"wpview-clipboard")||q||(k(),q++,g(!0,i));else{if(q=0,k(),j===i.previousSibling)return void g(!0,i);if(j===i.nextSibling)return void g(!1,i);e.addClass(i,h),o=setInterval(function(){e.hasClass(i,"wpview-cursor-hide")?e.removeClass(i,"wpview-cursor-hide"):e.addClass(i,"wpview-cursor-hide")},500)}else k()}),a.on("BeforeExecCommand",function(){var c,d=a.selection.getNode();d&&("wpview-selection-before"===d.className||"wpview-selection-after"===d.className)&&(c=b(d))&&(h(c),s=c)}),a.on("ExecCommand",function(){var b,c;n&&(b=n,k(),j(b)),s&&(c=s.nextSibling,c&&"P"===c.nodeName&&a.dom.isEmpty(c)&&(a.dom.remove(c),g(!1,s)),s=!1)}),a.on("ResolveName",function(c){a.dom.hasClass(c.target,"wpview-wrap")?(c.name=a.dom.getAttrib(c.target,"data-wpview-type")||"wpview",c.stopPropagation()):b(c.target)&&(c.preventDefault(),c.stopPropagation())}),a.addButton("removeview",{tooltip:"Remove",icon:"dashicons-no",onclick:function(){i(n)}}),a.addButton("editview",{tooltip:"Edit",icon:"dashicons-edit",onclick:function(){wp.mce.views.edit(n)},onPostRender:function(){var b=this;a.on("NodeChange",function(){n&&b.disabled(!wp.mce.views.canEdit(n))})}}),{getViewText:d,setViewText:e,getView:b}):{getViewText:y,setViewText:y,getView:y}});