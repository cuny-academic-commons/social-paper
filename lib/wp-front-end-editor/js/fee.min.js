!function(a){"use strict";window.wp=window.wp||{},wp.fee={},wp.heartbeat.interval(15),_.extend(wp.fee,window.fee),a(function(){function b(a){var b=a?"off":"on";_.each({"resize.fee-adjust-ui":u},function(a,c){T[b](c,a)}),_.each({"mousemove.fee-show-ui":v},function(a,c){U[b](c,a)})}function c(){b(!0)}function d(){H=!1,clearTimeout(I),I=setTimeout(function(){H=!0},3e5)}function e(){S&&(b(),u(),a("#wp-admin-bar-edit").addClass("active"),V.removeClass("fee-off").addClass("fee-on"),Y.addClass("has-post-thumbnail"),r(function(a){a.show()}),J=k(),wp.autosave&&(wp.autosave.local.resume(),wp.autosave.server.resume()),U.trigger("fee-on"),S=!1)}function f(a){S||"auto-draft"===wp.fee.post.post_status()||(n()?p(function(){g(a)}):g(a))}function g(b){wp.autosave&&(wp.autosave.local.suspend(),wp.autosave.server.suspend()),c(),a("#wp-admin-bar-edit").removeClass("active"),V.removeClass("fee-on").addClass("fee-off"),Z.find("img").length||Y.removeClass("has-post-thumbnail"),A.html(wp.fee.postOnServer.post_title),z.html(wp.fee.postOnServer.post_title),B&&(document.title=B.replace("<!--replace-->",wp.fee.postOnServer.post_title)),r(function(a){a.hide()}),U.trigger("fee-off"),S=!0,b&&(document.location.href=b)}function h(){S?e():f()}function i(){return!S}function j(){return S}function k(){var a={};return _.each(wp.fee.post,function(b,c){a[c]=b()}),a}function l(a,b){var c;U.trigger("fee-before-save"),c=k(),c.publish=b?!0:void 0,c.save=b?void 0:!0,c._wpnonce=wp.fee.nonces.post,db.prop("disabled",!0),wp.ajax.post("fee_post",c).always(function(){db.prop("disabled",!1)}).done(function(b){wp.fee.postOnServer=b.post,fb.html(b.processedPostContent),window.wpCookies.set("wp-saving-post-"+wp.fee.postOnServer.ID,"saved"),w&&w.remove(),x&&x.remove(),b.message&&(x=q(b.message,"updated",!0)),o(),J=k(),U.trigger("fee-after-save"),a&&a()}).fail(function(a){a.message&&q(a.message,"error")})}function m(a){l(a,!0)}function n(){return S?void 0:_.some(arguments.length?arguments:["post_title","post_content"],function(a){return J[a]&&wp.fee.post[a]?wp.fee.post[a]()!==J[a]:void 0})}function o(){S||r(function(a){a.undoManager.add()})}function p(a){hb.show(),hb.find(".fee-exit").focus().on("click.fee",function(){a(),hb.hide()}),hb.find(".fee-save-and-exit").on("click.fee",function(){l(a),hb.hide()}),hb.find(".fee-cancel").on("click.fee",function(){hb.hide()})}function q(b,c,d){var e=a("<div>").addClass(c);return e.append("<p>"+b+"</p>"+(d===!0?"":'<div class="dashicons dashicons-dismiss"></div>')),ib.prepend(e),e.find(".dashicons-dismiss").on("click.fee",function(){e.remove(),d!==!0&&d()}),d===!0&&e.delay(5e3).fadeOut("slow",function(){e.remove()}),e}function r(a){_.each(lb,a)}function s(a){lb.push(a),a.on("init",function(){a.hide(),mb++,mb===lb.length&&U.trigger("fee-editor-init")})}function t(){var b,c,d,e,f={};y=a(".fee-title"),z=y.parent(),y.remove(),A=[],!A.length&&z.each(function(b,c){a(c).parents().each(function(b,d){var e=a.inArray(d,kb);return e>-1?(f[e]=f[e]||[],f[e].push(c),!1):void 0})});for(b in f){A=a(f[b]);break}A.length&&(z=z.not(A),B=A.text().length?document.title.replace(A.text(),"<!--replace-->"):document.title,A.addClass("fee-title"),c=wp.fee.permalink.replace(/(?:%pagename%|%postname%)/,'<ins><span class="fee-slug">'+(wp.fee.postOnServer.post_name||wp.fee.postOnServer.ID)+"</span></ins>"),wp.fee.permalink!==c&&A.after('<p class="fee-url">'+c+"</p>"),C=a(".fee-url").hide(),D=a(".fee-slug"),P.init({selector:".fee-title",theme:"fee",paste_as_text:!0,plugins:"paste",inline:!0,placeholder:R.title,entity_encoding:"raw",setup:function(a){E=a,s(a),a.on("setcontent keyup",function(){wp.fee.post.post_title(wp.fee.post.post_title(),!0)}),a.on("keydown",function(a){13===a.keyCode&&(G.focus(),a.preventDefault())}),a.on("activate focus",function(){d=!0,C.slideDown("fast")}),a.on("deactivate blur hide",function(){d=!1,setTimeout(function(){e||C.slideUp("fast",function(){G.nodeChanged()})},100)})}}),P.init({selector:".fee-slug",theme:"fee",paste_as_text:!0,plugins:"paste",inline:!0,setup:function(a){F=a,s(a),a.on("setcontent keyup",function(){a.dom.isEmpty(a.getBody())&&(D.get(0).innerHTML="")}),a.on("keydown",function(b){P.util.VK.ENTER===b.keyCode?b.preventDefault():P.util.VK.SPACEBAR===b.keyCode&&(b.preventDefault(),a.insertContent("-"))}),a.on("blur",function(){a.isDirty()&&wp.ajax.post("fee_slug",{post_ID:wp.fee.post.post_ID(),post_title:wp.fee.post.post_title(),post_name:wp.fee.post.post_name(),_wpnonce:wp.fee.nonces.slug}).done(function(a){F.setContent(a)})}),C.on("click.fee",function(){a.focus()}),a.on("activate focus",function(){e=!0}),a.on("deactivate blur hide",function(){e=!1,setTimeout(function(){d||C.slideUp("fast",function(){G.nodeChanged()})},100)})}}))}function u(){var b=eb.get(0).getBoundingClientRect(),c=T.width();b.left>=c-b.right?V.removeClass("fee-right").addClass("fee-left"):V.removeClass("fee-left").addClass("fee-right"),cb.css({left:b.left,width:b.right-b.left}),a(".fee-publish-options-dropdown").css({right:c-b.right})}function v(a){M=a.clientY,O||(100>M||M>T.height()-100?(K||(cb.animate({bottom:0},"fast"),K=!0),(L=100>M)&&(clearTimeout(N),N=setTimeout(function(){L=!1,O||K&&!(100>M||M>T.height()-100)&&(cb.animate({bottom:-50},"slow"),K=!1)},3e3))):L||!K&&null!=K||(cb.animate({bottom:-50},"slow"),K=!1))}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P=window.tinymce,Q=P.util.VK,R=window.feeL10n,S=!0,T=a(window),U=a(document),V=a(document.body),W=a(".fee-post"),X=a('a[href="#fee-edit-link"]'),Y=a(".has-post-thumbnail"),Z=a(".fee-thumbnail"),$=a(".fee-thumbnail-wrap"),ab=a(".fee-edit-thumbnail").add(".fee-insert-thumbnail"),bb=a(".fee-remove-thumbnail"),cb=a(".fee-toolbar"),db=cb.find(".button").add(a(".fee-save-and-exit")),eb=a(".fee-content"),fb=a(".fee-content-original"),gb=a(".fee-categories"),hb=a(".fee-leave"),ib=a("#fee-notice-area"),jb=a(".fee-publish-options"),kb=eb.parents(),lb=[],mb=0,nb=!0;wp.fee.post={},_.each(wp.fee.postOnServer,function(a,b){wp.fee.post[b]=function(){return wp.fee.postOnServer[b]}}),wp.fee.post.post_ID=function(){return wp.fee.postOnServer.ID||0},wp.fee.post.post_title=function(a,b){return a?(B&&(document.title=B.replace("<!--replace-->",a)),z.each(function(b,c){c.innerHTML=a}),b||(A.get(0).innerHTML=a),this.post_title()):E?E.getContent()||"":wp.fee.postOnServer.post_title},wp.fee.post.post_name=function(){return F?F.getContent()||"":""},wp.fee.post.post_content=function(a){var b;return a&&"raw"!==a&&"html"!==a?(G.undoManager.add(),G.setContent(a),this.post_content()):(b=G.getContent({format:a||"html"})||"","raw"!==a&&(b=b.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),b=window.switchEditors.pre_wpautop(b)),b)},wp.fee.post.post_category=function(){var b=[];return a('input[name="post_category[]"]:checked').each(function(){b.push(a(this).val())}),b},wp.fee.post.post_status=function(){return"private"===a("#fee-post-visibility").val()?"private":a("#fee-post-status").val()||""},wp.fee.post.post_author_override=function(){return a("#fee-post-author").val()||0},wp.fee.post.sticky=function(){return"sticky"===a("#fee-post-visibility").val()||""},wp.fee.post.post_password=function(){return"password"===a("#fee-post-visibility").val()?a("#fee-post-password").val()||"":""},d(),P.init(_.extend(wp.fee.tinymce,{setup:function(a){G=a,window.wpActiveEditor=a.id,s(a),a.on("BeforeSetContent",function(a){a.content&&(a.content=a.content.replace(/<p>(?:&nbsp;|\s)+<\/p>/gi,"<p><br></p>"))})}})),t(),T.on("beforeunload.fee",function(){return!S&&n()?((event||window.event).returnValue=R.saveAlert,R.saveAlert):void 0}).on("unload.fee-remove-lock",function(a){nb&&(a.target&&"#document"!==a.target.nodeName||wp.ajax.post("wp-remove-post-lock",{_wpnonce:wp.fee.nonces.post,post_ID:wp.fee.post.ID(),active_post_lock:wp.fee.lock}))}),U.on("fee-editor-init.fee",function(){(V.hasClass("fee-on")||-1!==document.location.hash.indexOf("edit=true"))&&e(),V.hasClass("fee-off")&&!Z.find("img").length&&Y.removeClass("has-post-thumbnail"),U.on("autosave-restore-post",function(a,b){wp.fee.post.post_title(b.post_title),wp.fee.post.post_content(b.content)}),J=k(),wp.fee.postOnServer.post_content!==wp.fee.post.post_content()&&window.console.log("The content on the server and the content in the editor is different. This may be due to errors.")}).on("autosave-enable-buttons.fee",function(){db.prop("disabled",!1)}).on("autosave-disable-buttons.fee",function(){wp.heartbeat&&wp.heartbeat.hasConnectionError()||db.prop("disabled",!0)}).on("keydown.fee",function(a){83===a.keyCode&&Q.metaKeyPressed(a)&&(a.preventDefault(),l()),27===a.keyCode&&(a.preventDefault(),f())}).on("heartbeat-send.fee-refresh-lock",function(a,b){b["wp-refresh-post-lock"]={post_id:wp.fee.post.ID(),lock:wp.fee.lock}}).on("heartbeat-tick.fee-refresh-lock",function(b,c){var d,e,f=c["wp-refresh-post-lock"];f&&(f.lock_error?(d=a("#post-lock-dialog"),d.length&&!d.is(":visible")&&(wp.autosave&&(U.one("heartbeat-tick",function(){wp.autosave.server.suspend(),d.removeClass("saving").addClass("saved"),T.off("beforeunload.edit-post")}),d.addClass("saving"),wp.autosave.server.triggerSave()),f.lock_error.avatar_src&&(e=a('<img class="avatar avatar-64 photo" width="64" height="64" />').attr("src",f.lock_error.avatar_src.replace(/&amp;/g,"&")),d.find("div.post-locked-avatar").empty().append(e)),d.show().find(".currently-editing").text(f.lock_error.text),d.find(".wp-tab-first").focus())):f.new_lock&&(wp.fee.lock=f.new_lock))}).on("heartbeat-send.fee-refresh-nonces",function(a,b){H&&(b["wp-refresh-post-nonces"]={post_id:wp.fee.post.ID(),post_nonce:wp.fee.nonces.post})}).on("heartbeat-tick.fee-refresh-nonces",function(a,b){var c=b["wp-refresh-post-nonces"];c&&(d(),c.heartbeatNonce&&(window.heartbeatSettings.nonce=c.heartbeatNonce))}).on("after-autosave",function(){w&&w.fadeOut("slow",function(){w.remove()})}),X.on("click.fee",function(a){a.preventDefault(),h()}),gb.add(".fee-button-categories").on("click.fee",function(b){S||(b.preventDefault(),a(".fee-category-modal").modal("show"))}),a(".fee-category-modal").on("hide.bs.modal",function(){wp.ajax.post("fee_categories",{nonce:wp.fee.nonces.categories,post_ID:wp.fee.post.ID(),separator:gb.data("separator"),parents:gb.data("parents"),post_category:wp.fee.post.post_category()}).done(function(a){gb.html(a)})}),W.find('a[rel="tag"]').on("click.fee",function(a){a.preventDefault()}),W.find("time").add(W.find(".entry-date")).on("click.fee",function(a){a.preventDefault()}),W.find('a[rel="author"]').on("click.fee",function(a){a.preventDefault()}),a("a").not('a[href^="#"]').on("click.fee",function(b){var c=a(this);n()&&!Q.metaKeyPressed(b)&&(b.preventDefault(),p(function(){g(c.attr("href"))}))}),a(".fee-save").on("click.fee",function(){l()}),a(".fee-publish").on("click.fee",function(){m()}),jb.on("click.fee",function(){jb[O?"removeClass":"addClass"]("active"),a(".fee-publish-options-dropdown")[O?"hide":"show"](),O=!O}),wp.fee.notices.autosave&&(w=q(wp.fee.notices.autosave,"error")),_.extend(wp.media.featuredImage,{set:function(a){var b=wp.media.view.settings;b.post.featuredImageId=a,wp.media.post("fee_thumbnail",{post_ID:b.post.id,thumbnail_ID:b.post.featuredImageId,_wpnonce:b.post.nonce,size:Z.data("size")}).done(function(a){$.html(a),Z.removeClass("fee-thumbnail-active"),""===a?Z.addClass("fee-empty"):Z.removeClass("fee-empty")})}}),ab.on("click.fee-edit-thumbnail",function(){wp.media.featuredImage.frame().open()}),bb.on("click.fee-remove-thumbnail",function(){wp.media.featuredImage.set(-1)}),Z.on("click.fee-thumbnail-active",function(){S||Z.hasClass("fee-empty")||(Z.addClass("fee-thumbnail-active"),U.on("click.fee-thumbnail-active",function(a){Z.get(0)===a.target||Z.has(a.target).length||(Z.removeClass("fee-thumbnail-active"),U.off("click.fee-thumbnail-active"))}))}),a("#fee-post-visibility").on("change.fee-visibility",function(){"password"===a(this).val()?(a("#fee-post-password").parent().show(),a("#fee-post-password").val(wp.fee.postOnServer.post_password).focus()):a("#fee-post-password").parent().hide()}),a(".categorydiv").each(function(){var b,c,d,e,f,g=a(this).attr("id");d=g.split("-"),d.shift(),e=d.join("-"),f=e+"_tab","category"===e&&(f="cats"),a("a","#"+e+"-tabs").click(function(){var b=a(this).attr("href");return a(this).parent().addClass("tabs").siblings("li").removeClass("tabs"),a("#"+e+"-tabs").siblings(".tabs-panel").hide(),a(b).show(),"#"+e+"-all"===b?window.deleteUserSetting(f):window.setUserSetting(f,"pop"),!1}),window.getUserSetting(f)&&a('a[href="#'+e+'-pop"]',"#"+e+"-tabs").click(),a("#new"+e).one("focus",function(){a(this).val("").removeClass("form-input-tip")}),a("#new"+e).keypress(function(b){13===b.keyCode&&(b.preventDefault(),a("#"+e+"-add-submit").click())}),a("#"+e+"-add-submit").click(function(){a("#new"+e).focus()}),b=function(b){return a("#new"+e).val()?(b.data+="&"+a(":checked","#"+e+"checklist").serialize(),a("#"+e+"-add-submit").prop("disabled",!0),b):!1},c=function(b,c){var d,f=a("#new"+e+"_parent");a("#"+e+"-add-submit").prop("disabled",!1),"undefined"!==c.parsed.responses[0]&&(d=c.parsed.responses[0].supplemental.newcat_parent)&&(f.before(d),f.remove())},a("#"+e+"checklist").wpList({alt:"",response:e+"-ajax-response",addBefore:b,addAfter:c}),a("#"+e+"-add-toggle").click(function(){return a("#"+e+"-adder").toggleClass("wp-hidden-children"),a('a[href="#'+e+'-all"]',"#"+e+"-tabs").click(),a("#new"+e).focus(),!1}),a("#"+e+"checklist, #"+e+"checklist-pop").on("click",'li.popular-category > label input[type="checkbox"]',function(){var b=a(this),c=b.is(":checked"),d=b.val();d&&b.parents("#taxonomy-"+e).length&&a("#in-"+e+"-"+d+", #in-popular-"+e+"-"+d).prop("checked",c)})}),_.extend(wp.fee,{on:e,off:f,toggle:h,isOn:i,isOff:j,isDirty:n,save:l,publish:m,addNotice:q,getPost:k})})}(jQuery);